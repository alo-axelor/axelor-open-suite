<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_6.1.xsd">

  <grid name="ticket-status-grid" title="Ticket statuses"
    model="com.axelor.apps.helpdesk.db.TicketStatus" orderBy="priority">
    <field name="name"/>
    <field name="priority"/>
    <field name="isClosedStatus"/>
    <field name="isOngoingStatus"/>
    <field name="isResolvedStatus"/>
  </grid>

  <form name="ticket-status-form" title="Ticket status"
    model="com.axelor.apps.helpdesk.db.TicketStatus" onSave="action-ticket-status-validate-on-save">
    <panel name="mainPanel">
      <field name="name"/>
      <field name="priority"/>
      <field name="isOngoingStatus" readonlyIf="isClosedStatus || isResolvedStatus"/>
      <field name="isClosedStatus" readonlyIf="isOngoingStatus || isResolvedStatus"/>
      <field name="isResolvedStatus" readonlyIf="isOngoingStatus || isClosedStatus"/>
    </panel>
    <panel-mail name="mailPanel">
      <mail-messages limit="4"/>
      <mail-followers/>
    </panel-mail>
  </form>

  <action-validate name="action-ticket-status-validate-on-save">
    <error message="Status with same priority already exists."
      if="(id &amp;&amp; __repo__(TicketStatus).all().filter('self.priority = ?1 AND self.id != ?2',priority,id).count() > 0) || (!id &amp;&amp; __repo__(TicketStatus).all().filter('self.priority = ?',priority).count() > 0)"/>
    <error message="Closed status already exists."
      if="isClosedStatus &amp;&amp; ((id &amp;&amp; __repo__(TicketStatus).all().filter('self.isClosedStatus = true AND self.id != ?',id).count() > 0) || (!id &amp;&amp; __repo__(QIStatus).all().filter('self.isClosedStatus = true').count() > 0))"/>
    <error message="Resolved status already exists."
      if="isResolvedStatus &amp;&amp; ((id &amp;&amp; __repo__(TicketStatus).all().filter('self.isResolvedStatus = true AND self.id != ?',id).count() > 0 ) || (!id &amp;&amp; __repo__(TicketStatus).all().filter('self.isResolvedStatus = true').count() > 0))"/>
  </action-validate>

</object-views>
